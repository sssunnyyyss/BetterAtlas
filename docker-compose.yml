services:
  api:
    build:
      context: .
      dockerfile: api/Dockerfile
      target: development
    ports:
      - "3001:3001"
    environment:
      SUPABASE_URL: ${SUPABASE_URL}
      SUPABASE_ANON_KEY: ${SUPABASE_ANON_KEY}
      SUPABASE_SERVICE_ROLE_KEY: ${SUPABASE_SERVICE_ROLE_KEY}
      DATABASE_URL: ${DATABASE_URL_DOCKER}
      CORS_ORIGIN: http://localhost:5173
      API_PORT: "3001"
      NODE_ENV: development
    volumes:
      - ./api/src:/app/api/src:cached
      - ./packages/shared/src:/app/packages/shared/src:cached
      - ./packages/shared/dist:/app/packages/shared/dist:cached
      - /app/api/node_modules
      - /app/packages/shared/node_modules

  frontend:
    build:
      context: .
      dockerfile: frontend/Dockerfile
      target: development
    ports:
      - "5173:5173"
    depends_on:
      - api
    environment:
      VITE_SUPABASE_URL: ${VITE_SUPABASE_URL}
      VITE_SUPABASE_ANON_KEY: ${VITE_SUPABASE_ANON_KEY}
    volumes:
      - ./frontend/src:/app/frontend/src:cached
      - ./frontend/vite.config.ts:/app/frontend/vite.config.ts:cached
      - ./packages/shared/src:/app/packages/shared/src:cached
      - ./packages/shared/dist:/app/packages/shared/dist:cached
      - /app/frontend/node_modules
      - /app/packages/shared/node_modules
